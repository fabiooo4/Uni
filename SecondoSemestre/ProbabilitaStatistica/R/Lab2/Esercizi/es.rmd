---
title: "Lab2"
subtitle: "Exercises"
author: "Irimie Fabio"
output: 
  pdf_document:
    toc: true
    keep_tex: true 
---

# Exercise 1 - Create a new mean and sd function 

## A
Create the Lab2 project. Use the same structure used for Lab1:

  - scripts,
  - plots,
  - data


## B
Install the palmerpenguins package, load the penguins dataset or,
alternatively, download the .RData object from moodle and import it
after placing it inside the data directory of the project (hint:
use the load() function). 

```{r}
library(palmerpenguins)
data(penguins)
```

## C
Compute the mean, the standard deviation, and the median for the 
numeric variables of
the dataset.

```{r, collapse=TRUE}
# Means
cat("Means: \n")
colMeans(penguins[, c(3:6, 8)], na.rm = TRUE)
cat("\n")

# Medians
cat("Medians: \n")
sapply(penguins[, c(3:6, 8)], median, na.rm = TRUE)
cat("\n")

# Standard deviations
cat("Standard deviations: \n")
sapply(penguins[, c(3:6, 8)], sd, na.rm = TRUE)
cat("\n")
```

## D
Create a function called stat_auto that simultaneously returns both
the mean and the
standard deviation of a given vector (hint: return an object of type
list or simply a vector). Then try it on the same numeric variables in
C. to check the results (hint: if you obtain NA
maybe you forgot to remove NA terms in the vector).

```{r}
stat_auto <- function(vec, na.rm = FALSE) {
  if (na.rm) {
    mean <- mean(vec, na.rm = TRUE)
    sd <- sd(vec, na.rm = TRUE)

    return(list("mean" = mean, "sd" = sd))
  }

  mean <- mean(vec)
  sd <- sd(vec)

  return(list("mean" = mean, "sd" = sd))
}

sapply(penguins[, c(3:6, 8)], stat_auto, na.rm = TRUE)
```

## E
Create a function called stat_manual that simultaneously returns
both the mean and the
standard deviation of a given vector without using the mean() and the
sd() functions
(hint: you can use length(), sum(), and na.omit() functions). Then
try it on the same
numeric variables in C. to check the results.

```{r}
stat_manual <- function(vec, na.rm = FALSE) {
  if (na.rm) {
    sum <- sum(vec, na.rm = TRUE)
    mean <- sum / na.omit(length(vec))

    sum <- sum((vec - mean)^2, na.rm = TRUE)
    denom <- na.omit(length(vec)) - 1
    varianza <- sum / denom

    sd <- sqrt(varianza)

    return(list("mean" = mean, "sd" = sd))
  }

  sum <- sum(vec)
  mean <- sum / length(vec)

  sum <- sum((vec - mean)^2)
  denom <- length(vec) - 1
  varianza <- sum / denom

  sd <- sqrt(varianza)

  return(list("mean" = mean, "sd" = sd))
}

sapply(penguins[, c(3:6, 8)], stat_manual, na.rm = TRUE)
```

# Exercise 2 - Table of frequencies

## A
In the penguins dataset, transform a numeric variable to a categorical
one by  aggregating values into classes. Consider the flipper length 
variable and create  10mm wide classes using the cut() function (hint:
use the range() function to  determine the min and max values of the 
variable, then define a sequence for the  cuts). 

```{r}
r <- range(penguins$flipper_length_mm, na.rm = TRUE)
splits <- seq(r[1], r[2], 10)
splits <- append(splits, r[2])

classes <- cut(penguins$flipper_length_mm, splits, ordered_result = TRUE)

cat("Splits: ", splits, "\n")
cat("Classes: \n")
classes
```

## B
Use the table() function on the new variable generated by cut(). Then
transform it into a data.frame object. Rename the columns accordingly 
using the colnames() function (hint: the second column correspond to
the absolute frequencies). 

```{r}
df <- data.frame(table(classes))
colnames(df) <- c("Classes", "AbsoluteFrequencies")
df
```

## C
Add the the columns for: relative frequencies, cumulative absolute 
frequencies, and  cumulative relative frequencies.

```{r}
df$CumAbsFreq <- cumsum(df$AbsoluteFrequencies)
df$RelativeFrequencies <- df$AbsoluteFrequencies / sum(df$AbsoluteFrequencies)
df$RelAbsFreq <- cumsum(df$RelativeFrequencies)
df
```

## D
Use the geom_col() function to plot the frequence of each class. Then,
using the  geom_text(aes(label = …)) function, add the relative 
frequence as a percentage above each column (hint: substitute the …
with the relative frequency values. Use the  round() function to 
choose the appropriate number of digits).

```{r, warning=FALSE}
library(ggplot2)
ggplot(
  data = df,
  aes(
    x = df$Class,
    y = df$AbsoluteFrequency,
  )
) +
  geom_col(aes(y = df$AbsoluteFrequencies)) +
  geom_text(
    aes(
      label = paste(round(df$RelativeFrequencies * 100, 2), "%"),
      y = df$AbsoluteFrequencies,
    ),
    vjust = -0.5,
  ) +
  labs(
    title = "Flipper length by class",
    x = "Flipper length class (mm)",
    y = "Absolute frequency",
  ) +
  theme(legend.position = "bottom")
```

# Exercise 3 - Histogram, Boxplot and quartiles 
## A
Using the geom_histogram() function of the ggplot2 package plot the 
flipper length distribution coloring each species with a different 
color (hint: use the fill argument of the aes() function to fill the  
histogram area and the position = "identity" argument of the 
geom_histogram()). Play with the  binwidth argument. Try to insert 
y = ..density.. in aes(). Do you notice any change?

```{r, warning = FALSE}
ggplot(
  data = penguins,
  aes(
    x = penguins$flipper_length_mm,
    fill = penguins$species,
  )
) +
  scale_fill_manual(values = c("darkorange", "purple", "cyan4")) +
  geom_histogram(
    position = "identity",
    binwidth = 2,
    aes(y = ..density..),
  ) +
  labs(
    title = "Flipper length distribution",
    x = "Flipper length (mm)",
    y = "Density",
    fill = "Species",
  ) +
  theme(legend.position = "bottom")
```

## B
About the flipper length, for each species of penguins compute the:
  1. Sample mean
  2. Sample median
  3. Sample standard deviation (use a division by $n-1$)
  4. Sample variance

  (hint: to choose only a specific species use 
  penguins[penguins$species == "Gentoo",])
```{r}
species <- unique(penguins$species)
summary <- data.frame(
  Specie = species
)

for (specie in species) {
  summary$Mean[which(specie == species)] <-
    mean(penguins[penguins$species == specie, ]$flipper_length_mm,
      na.rm = TRUE
    )
  summary$Median[which(specie == species)] <-
    median(penguins[penguins$species == specie, ]$flipper_length_mm,
      na.rm = TRUE
    )
  summary$StandardDeviation[which(specie == species)] <-
    sd(penguins[penguins$species == specie, ]$flipper_length_mm,
      na.rm = TRUE
    )
  summary$Variance[which(specie == species)] <-
    var(penguins[penguins$species == specie, ]$flipper_length_mm,
      na.rm = TRUE
    )
}
summary
```

## C
Using the geom_boxplot() function of the ggplot2 package plot the 
boxplot for the flipper length variable coloring each species with 
a different color (hint: use the color argument of the aes() function).
```{r}
ggplot(
  penguins,
  aes(
    x = penguins$flipper_length_mm,
    color = penguins$species
  )
) +
  scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
  geom_boxplot(
    aes(x = penguins$flipper_length_mm)
  )
```

## D
Compute the flipper length quartiles for the "Gentoo" penguins 
(Q1, Q2, Q3).
```{r}
gentoo <- penguins[penguins$species == "Gentoo", ]
quartiles <- quantile(
  gentoo$flipper_length_mm,
  c(0.25, 0.5, 0.75),
  na.rm = TRUE
)
quartiles
```

## E
Calculate the flipper length 40th percentile for the "Adelie" penguins.
```{r}
adelie <- penguins[penguins$species == "Adelie", ]
p40 <- quantile(
  adelie$flipper_length_mm,
  0.4,
  na.rm = TRUE
)
p40
```

# Exercise 4 - Multiple boxplots from scratch
## A
Generate random data with some structure, and create one data set for 
each day of  the week (hint: use the for() cycle, data should have 7
columns). At the end you should obtain a matrix with N rows 
(N = number of random number to generate each time) and 7 columns 
(one for each day of the week).
```{r}
set.seed(123)
n <- 10
days <- c(
  "Monday",
  "Tuesday",
  "Wednesday",
  "Thursday",
  "Friday",
  "Saturday",
  "Sunday"
)
data <- matrix(nrow = n, ncol = 7)

for (i in 1:7) {
  data[, i] <- round(runif(n, min = 0, max = 100), 0)
}

df <- data.frame(data)
colnames(df) <- days
df
```

## B
Go from a wide to a long data format. You should create a data.frame 
object with  exactly two columns. One contains the values created in 
A., the other contains the corresponding day of the week.
```{r}
df_long <- data.frame(
  "Day" = rep(days, each = n),
  "Value" = c(
    df$Monday,
    df$Tuesday,
    df$Wednesday,
    df$Thursday,
    df$Friday,
    df$Saturday,
    df$Sunday
  )
)
df_long
```

## C
Plot the seven boxplots (one for each day of the week) in one graph,
horizontally oriented (hint: coord_flip() function translates the axes,
the "limits" argument of scale_x_discrete() allows you to reorder the 
axis labels).
```{r}
ggplot(
  df_long,
  aes(
    x = Day,
    y = Value,
    color = Day
  )
) +
  scale_color_manual(values = rainbow(7)) +
  scale_x_discrete(limits = rev(days)) +
  geom_boxplot() +
  coord_flip() +
  labs(
    title = "Random values by day of the week",
    x = "Day of the week",
    y = "Random value",
    color = "Day of the week"
  )
```

# Exercise 5 - Exploratory analysis of data
Penguins dataset does not contain their weights and flipper lengths only. 
Many other variables are  available. Let’s explore it a little more:

## A
How many islands are there? And how many penguins are present in each 
isle? Are the 3 species of  penguins living together? (hint: use the 
table() function).
```{r}
cat("The number of islands is: ", length(unique(penguins$island)), "\n")
table(penguins$island)
table(penguins$island, penguins$species)
```

## B
Try to use the geom_bar() or geom_col() functions to graphically 
represent the population of each island, colored by species 
(hint: islands in the x-axis, number of penguins in the y-axis).
```{r}
ggplot(
  penguins,
  aes(
    x = island,
    fill = species
  )
) +
  geom_bar() +
  scale_fill_manual(values = c("darkorange", "purple", "cyan4")) +
  labs(
    title = "Penguins population by island",
    x = "Island",
    y = "Number of penguins",
    fill = "Species"
  )
```

## C
Use a scatter plot to represent flipper length vs. body mass. Color 
the point according to the "sex"  variable. Try to use facets to see 
if there are differences across species (hint: use 
facet_grid(~  species) function to add facets for species).
```{r, warning=FALSE}
ggplot(
  penguins,
  aes(
    x = penguins$flipper_length_mm,
    y = penguins$body_mass_g,
    color = penguins$sex
  )
) +
  geom_point() +
  facet_grid(~species) +
  scale_color_manual(values = c("blue", "magenta")) +
  labs(
    title = "Flipper length vs. body mass",
    x = "Flipper length (mm)",
    y = "Body mass (g)",
    color = "Sex"
  )
```

## D
The numeric variables shows some interesting relationships. Are they 
correlated? Use the cor() and the  corrplot() functions to study 
correlations between numeric variables (hint: try to google 
corrplot() to see which package you have to install to use it).
```{r}
library(corrplot)
correlation <- cor(penguins[, c(3:6, 8)], use = "complete.obs")
corrplot(correlation, method = "number")
```
```{r}
corrplot(correlation, method = "color")
```
```{r}
corrplot(correlation)
```
```{r}
corrplot(correlation, order = "AOE")
```

## E
Choose a pair of numeric variables, compute the correlation between 
them without using the cor() function (hint: remember the formula).
```{r}
x <- penguins$flipper_length_mm
y <- penguins$body_mass_g

n <- length(x)
mean_x <- mean(x, na.rm = TRUE)
mean_y <- mean(y, na.rm = TRUE)

covariance <- sum((x - mean_x) * (y - mean_y), na.rm = TRUE) / (n - 1)
sd_x <- sqrt(sum((x - mean_x)^2, na.rm = TRUE) / (n - 1))
sd_y <- sqrt(sum((y - mean_y)^2, na.rm = TRUE) / (n - 1))

correlation <- covariance / (sd_x * sd_y)
cat(
  "The correlation between flipper length and body mass is: ",
  correlation, "\n"
)
```

## F
Plot the scatter plot for bill length vs. bill depth. Color the points 
by species. Use the function geom_smooth(formula = "y ~ x") to add a
line to represent the linear relationship between the two variables.
Then, again, use geom_smooth(formula = "y ~ x") colored by species. 
What are you noticing?
```{r, warning=FALSE}
ggplot(
  penguins,
  aes(
    x = penguins$bill_length_mm,
    y = penguins$bill_depth_mm,
    color = penguins$species
  )
) +
  geom_point() +
  geom_smooth(
    formula = "y ~ x",
    method = "lm",
    aes(color = penguins$species),
    se = FALSE
  ) +
  scale_color_manual(values = c("darkorange", "purple", "cyan4")) +
  labs(
    title = "Bill length vs. bill depth",
    x = "Bill length (mm)",
    y = "Bill depth (mm)",
    color = "Species"
  )
```
